#!/usr/bin/env bash
source d-var.conf

menuopts=(" Select Area in Mouse" " Copy Area of Screen" " Full Display" " Copy Whole Display" " Active Window")

nameopts=(
    "notes-refer"
    "receipt-"
    "ppt-pic"
    "share-detail"
    )

sleep_for='sleep 0.5'
temp_pic='/tmp/thescr.png'
ident=$(date +%Y%m%dT%H%M%S)

gimme() {
output=$(date +'%d-%a  %H:%M:%S')
picname=$(printf '%s\n' "${nameopts[@]}" | ${D_MENU} -l 5 -i -p ' ' || echo $output )
tagname=$(echo "" | ${D_MENU} -l 5 -i -p ' ')

cp $temp_pic ~/pics/sshots/"${ident}-${picname}_${tagname}.png"
}

sshot=$(printf '%s\n' "${menuopts[@]}" | sort | $D_MENU -p 'Snap ScreenShot of ')

case "$sshot" in
    "${menuopts[0]}") $sleep_for && grim -g "$(slurp)" "${temp_pic}" && gimme ;;
    "${menuopts[1]}") $sleep_for && grim -g "$(slurp)" - | wl-copy --type image/png ;;
    "${menuopts[2]}") $sleep_for && grim -c "${temp_pic}" && gimme ;;
    "${menuopts[3]}") $sleep_for && grim -c - | wl-copy --type image/pngi ;;
    "${menuopts[4]}") $sleep_for && grim -g \
           "$(hyprctl activewindow -j | jq -r '"\(.at[0]),\(.at[1]) \(.size[0])x\(.size[1])"')" "${temp_pic}" && gimme ;;
    #	*) sleep 0.5 && grim "/tmp/thescr.png" || exit ;;
esac
